<!-- {% load static %} -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QueueAU Live Queue Monitor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
    <style>
      :root {
        --primary-color: #1c2d5a; 
        --primary-dark: #1d4ed8;
        --secondary-color: #059669;
        --accent-color: #198038;
        --danger-color: #dc2626;
        --warning-color: #d97706;
        --light-bg: #f8fafc;
        --card-bg: #ffffff;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --border-color: #e2e8f0;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      }
  
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
  
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        color: var(--text-primary);
        font-family: 'Inter', sans-serif;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
      }

      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>');
        pointer-events: none;
        z-index: -1;
      }
  
      .main-container {
        background: var(--light-bg);
        min-height: 100vh;
        position: relative;
      }
  
      /* Header Styles */
      header {
        background: rgba(255, 255, 255, 0.95);
        padding: 1rem 2rem;
        box-shadow: var(--shadow-md);
        position: sticky;
        top: 0;
        z-index: 1000;
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }
  
      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1400px;
        margin: 0 auto;
      }
  
      .logo-section {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
  
      #logo {
        height: 60px;
        width: auto;
        transition: transform 0.3s ease;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        width: 45px;
      height: 45px;
      object-fit: cover;
      border: 3px solid #fff;
      box-shadow: var(--shadow-light);
      }
  
      #logo:hover {
        transform: scale(1.05);
      }
  
        .brand-info h1 {
         font-size: 1.5rem;
         font-weight: 800;
         color: #1c2d5a;
         margin: 0;
         letter-spacing: -0.025em;
       }
  
      .brand-info p {
        font-size: 0.875rem;
        color: var(--text-secondary);
        margin: 0;
        font-weight: 500;
      }
  
        #date-time {
         background: linear-gradient(135deg, #1c2d5a, #2d4a7c, #3b5998);
         color: white;
         padding: 1rem 2rem;
         border-radius: 20px;
         font-weight: 700;
         font-size: 1.125rem;
         box-shadow: var(--shadow-lg);
         text-align: center;
         min-width: 320px;
         position: relative;
         overflow: hidden;
         transition: all 0.3s ease;
        }

        #date-time::before {
         content: '';
         position: absolute;
         top: 0;
         left: -100%;
         width: 100%;
         height: 100%;
         background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
         transition: left 0.5s;
        }

        #date-time:hover::before {
         left: 100%;
        }

        #date-time:hover {
         transform: translateY(-2px);
         box-shadow: var(--shadow-xl);
        }
  
        /* Main Content */
       .main-content {
         max-width: 1400px;
         margin: 0 auto;
         padding: 1rem;
         padding-bottom: 5rem; 
       }
  
        .page-title {
         text-align: center;
         position: relative;
       }
  
        .page-title h2 {
           font-size: 2.5rem;
           font-weight: 900;
           color: var(--text-primary);
           letter-spacing: -0.025em;
           background: linear-gradient(135deg, #1c2d5a, #198038);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
           background-clip: text;
         }
  
      .page-title p {
        color: var(--text-secondary);
        font-size: 1.125rem;
        font-weight: 500;
      }
  
             /* Now Serving Section */
                    .now-serving-section {
         background: rgba(255, 255, 255, 0.95);
         border-radius: 25px;
         padding: 2rem;
         margin-bottom: 1rem;
         box-shadow: var(--shadow-xl);
         border: 1px solid rgba(255, 255, 255, 0.2);
         backdrop-filter: blur(10px);
         position: relative;
         overflow: hidden;
       }

               .now-serving-section::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, #1c2d5a, #198038);
        }
  
        .now-serving-header {
         text-align: center;
         margin-bottom: 1.5rem;
         position: relative;
       }
  
        .now-serving-header h3 {
         font-size: 1.75rem;
         font-weight: 800;
         color: #1c2d5a;
         margin-bottom: 0.5rem;
         text-transform: uppercase;
         letter-spacing: 0.1em;
       }
  
             .now-serving-header::after {
         content: '';
         position: absolute;
         bottom: -10px;
         left: 50%;
         transform: translateX(-50%);
         width: 60px;
         height: 4px;
         background: linear-gradient(90deg, #1c2d5a, #198038);
         border-radius: 2px;
       }
  
      /* Queue Cards */
      .queue-card {
        background: #ffffff;
        margin-bottom: 2rem;
        padding: 1.5rem;
        border-radius: 1.25rem;
        border-left: 8px solid var(--primary-color);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        position: relative;
        transition: transform 0.3s ease;
      }
  
      .queue-card:hover {
        transform: translateY(-5px);
      }
  
      .queue-card.window-active {
        background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
        border-color: var(--primary-color);
      }
  
      .queue-header {
        font-size: clamp(1.1rem, 2vw, 1.3rem);
        font-weight: 600;
        color: var(--accent-color);
        text-align: center;
        margin-bottom: 1rem;
      }
  
      .queue-number {  
        font-family: 'Bebas Neue', sans-serif;
        font-weight: 900;
        font-size: clamp(2.5rem, 6vw, 4rem);
        text-align: center;
        color: var(--primary-color);
        text-shadow: 0 0 5px #cfd9ea;
        animation: pulse 1.5s infinite;
      }
  
      .queue-title {
        font-weight: 800;
        font-size: clamp(1rem, 2.5vw, 1.4rem);
        letter-spacing: 0.5px;
        text-transform: uppercase;
        margin-bottom: 0.75rem;
      }
  
      .status-badge {
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
  
      .status-badge.processing {
        background: linear-gradient(135deg, var(--secondary-color), #10b981);
        color: white;
      }
  
      .status-badge.completed {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
      }
  
      .status-badge.on_hold {
        background: linear-gradient(135deg, var(--warning-color), #f59e0b);
        color: white;
      }
  
                           
  
      @keyframes pulse {
        0%, 100% { text-shadow: 0 0 10px #d0e2ff, 0 0 20px #d0e2ff; }
        50% { text-shadow: 0 0 20px #84a9ff, 0 0 30px #84a9ff; }
      }
  
      
             /* Sidebar Styles */
       .sidebar {
         background: rgba(255, 255, 255, 0.95);
         border-radius: 20px;
         padding: 1rem;
         box-shadow: var(--shadow-xl);
         border: 1px solid rgba(255, 255, 255, 0.2);
         height: calc(100vh - 280px);
         overflow-y: auto;
         backdrop-filter: blur(10px);
         position: relative;
         overflow: hidden;
       }

      .sidebar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #1c2d5a, #198038);
      }
  
             .queue-section {
         margin-bottom: 1rem;
       }
  
      .queue-section:last-child {
        margin-bottom: 0;
      }
  
      .queue-title {
        font-size: 1rem;
        font-weight: 700;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
  
      .queue-title.priority {
        color: var(--danger-color);
      }
  
      .queue-title.standard {
        color: var(--primary-color);
      }
  
      .queue-title.onhold {
        color: var(--warning-color);
      }
  
      .queue-list {
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: 120px;
        overflow-y: auto;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(5px);
      }
  
      .queue-list::-webkit-scrollbar {
        width: 6px;
      }
  
      .queue-list::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
      }
  
      .queue-list::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
  
      .queue-list::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
  
             .queue-item {
         padding: 0.5rem 0.75rem;
         border-bottom: 1px solid rgba(255, 255, 255, 0.2);
         display: flex;
         justify-content: space-between;
         align-items: center;
         transition: all 0.3s ease;
         position: relative;
         overflow: hidden;
       }

      .queue-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
        transition: left 0.5s;
      }

      .queue-item:hover::before {
        left: 100%;
      }
  
      .queue-item:last-child {
        border-bottom: none;
      }
  
      .queue-item:hover {
        background-color: rgba(102, 126, 234, 0.1);
        transform: translateX(5px);
      }
  
             .queue-item-number {
         font-weight: 600;
         color: var(--text-primary);
         font-size: 0.9rem;
       }
  
             .queue-item-time {
         font-size: 0.7rem;
         color: var(--text-secondary);
         background: #f1f5f9;
         padding: 0.2rem 0.4rem;
         border-radius: 4px;
         font-weight: 500;
       }
  
      .empty-queue {
        padding: 1rem;
        text-align: center;
        color: var(--text-secondary);
        font-style: italic;
        background: #f8fafc;
        border-radius: 8px;
        margin: 0.5rem;
      }
  
             /* Footer */
       footer {
         background: linear-gradient(135deg, #1c2d5a, #2d4a7c, #3b5998);
         color: white;
         padding: 0.75rem 0;
         position: fixed;
         bottom: 0;
         left: 0;
         right: 0;
         z-index: 1000;
         overflow: hidden;
         box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
       }
  
      footer::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
      }
  
             .footer-content {
         position: relative;
         z-index: 1;
         text-align: center;
         font-weight: 600;
         font-size: 1.25rem;
       }
  
      /* Loading States */
      .loading-skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: 8px;
        height: 20px;
        margin-bottom: 0.5rem;
      }
  
      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
  
      /* Responsive Design */
      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
        }
  
        .main-content {
          padding: 1rem;
        }
  
        .page-title h2 {
          font-size: 2rem;
        }
  
        .queue-number {
          font-size: 2.5rem;
        }
  
        .sidebar {
          margin-bottom: 2rem;
        }
      }
  
      /* Animations */
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
  
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
  
      .slide-in {
        animation: slideIn 0.6s ease-out;
      }
  
      @keyframes slideIn {
        from { opacity: 0; transform: translateX(-30px); }
        to { opacity: 1; transform: translateX(0); }
      }
    </style>
  </head>
  
  <body>
    <div class="main-container">
      <!-- Header -->
      <header>
        <div class="header-content">
          <div class="logo-section">
                    <img id="logo" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQrS9jRQE3OmdVb2BR4rlB4QF0xIJSxEJrrIA&s" alt="PHINMA AU Logo" class="rounded-circle" >
            <div class="brand-info">
              <h1>QueueAU</h1>
              <p>Live Queue Monitoring System</p>
            </div>
          </div>
          <div id="date-time">
            <i class="fas fa-clock me-2"></i>
            Loading time...
          </div>
        </div>
      </header>
  
      <!-- Main Content -->
      <div class="main-content">
        <div class="page-title">
          <h2>Live Queue Monitor</h2>
        </div>
  
                 <div class="row g-3">
          <!-- Sidebar: Upcoming Queues -->
          <div class="col-lg-3">
            <div class="sidebar">
              <!-- Priority Queue -->
              <div class="queue-section">
                <h5 class="queue-title priority">
                  <i class="fas fa-exclamation-triangle"></i>
                  Priority Queue
                </h5>
                                                                   <ul id="priority-queue" class="queue-list">
                  </ul>
              </div>
  
              <!-- Standard Queue -->
              <div class="queue-section">
                <h5 class="queue-title standard">
                  <i class="fas fa-list-ol"></i>
                  Standard Queue
                </h5>
                                                                   <ul id="standard-queue" class="queue-list">
                  </ul>
              </div>
  
              <!-- On Hold Queue -->
              <div class="queue-section">
                <h5 class="queue-title onhold">
                  <i class="fas fa-pause-circle"></i>
                  On-Hold Queue
                </h5>
                                                                   <ul id="on-hold-queue" class="queue-list">
                  </ul>
              </div>
            </div>
          </div>
  
          <!-- Main Area: Now Serving -->
          <div class="col-lg-9">
            <div class="now-serving-section">
              <div class="now-serving-header">
                <h3><i class="fas fa-broadcast-tower me-2"></i>Now Serving</h3>
              </div>
                                                                                                                       <div id="queue-container" class="row g-2">
                </div>
              <div id="last-updated" class="text-center mt-4 text-muted small"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Footer -->
    <footer>
      <div class="footer-content">
                 <marquee behavior="scroll" direction="left" scrollamount="4">
           <i class="fas fa-info-circle me-3"></i>
           Welcome to PHINMA AU! | Please ready your payment when your number is called. | 
           Queue updates in real-time. | 
           </i> Thank you for your patience and for choosing PHINMA AU! | 
            We prioritize your convenience.
         </marquee>
      </div>
    </footer>
  
    <!-- JavaScript for date/time and queue -->
  <!-- JavaScript for date/time and queue -->
<script>
  let announcedSet = new Set();

  function speakAnnouncement(queueNumber, windowNumber) {
    const msg = new SpeechSynthesisUtterance(`Now serving queue number ${queueNumber} at window number ${windowNumber}`);
    msg.rate = 1;
    msg.pitch = 1;
    speechSynthesis.speak(msg);
  }

  function fetchLiveQueue() {
    fetch("/live-queue/")
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById("queue-container");
        container.innerHTML = "";

        if (data.length === 0) {
          container.innerHTML = `<div class="text-center text-muted">No queues currently in process.</div>`;
          return;
        }

        data.forEach(item => {
          const col = document.createElement("div");
          col.className = "col-md-6 col-lg-4";

          const card = document.createElement("div");
          card.className = "queue-card";

          const formattedStatus = item.status.replace("_", " ").toUpperCase();

          card.innerHTML = `
            <div class="queue-header">Window ${item.window}</div>
            <div class="queue-number">${item.queue_number}</div>
            <div class="text-center">
              <span class="badge-status">${formattedStatus}</span>
            </div>
          `;

          col.appendChild(card);
          container.appendChild(col);

          const uniqueKey = `${item.queue_number}|${item.window}`;
          if (!announcedSet.has(uniqueKey)) {
            announcedSet.add(uniqueKey);
            speakAnnouncement(item.queue_number, item.window);
          }
        });

        const now = new Date();
        const timeString = now.toLocaleTimeString();
        const dateString = now.toLocaleDateString();
        document.getElementById("last-updated").textContent = "Last updated: " + timeString;
      })
      .catch(err => {
        console.error("Error fetching live queue:", err);
      });
  }

  setInterval(fetchLiveQueue, 1000);
  fetchLiveQueue();

  function updateDateTime() {
  const now = new Date();

  const optionsDate = { year: 'numeric', month: 'long', day: 'numeric' };
  const dateString = now.toLocaleDateString('en-US', optionsDate);

  const optionsDay = { weekday: 'long' };
  const dayString = now.toLocaleDateString('en-US', optionsDay);

  const optionsTime = { hour: 'numeric', minute: 'numeric', second: 'numeric', hour12: true };
  const timeString = now.toLocaleTimeString('en-US', optionsTime);

  document.getElementById("date-time").textContent = `${dateString} | ${dayString} | ${timeString}`;
}

// Run once immediately
updateDateTime();

// Optional: update every second
setInterval(updateDateTime, 1000);
</script>


<script>
function fetchPublicQueues() {
fetch("/public-next-queues/")
  .then(response => response.json())
  .then(data => {
    const priorityList = document.getElementById("priority-queue");
    const standardList = document.getElementById("standard-queue");
    const onHoldList = document.getElementById("on-hold-queue");

    priorityList.innerHTML = "";
    standardList.innerHTML = "";
    onHoldList.innerHTML = "";

    const renderQueue = (listElement, dataList, labelClass, emptyText) => {
      if (dataList.length === 0) {
        listElement.innerHTML = `<li class='list-group-item text-muted'>${emptyText}</li>`;
      } else {
        dataList.forEach(txn => {
          const li = document.createElement("li");
          li.className = "list-group-item d-flex justify-content-between align-items-center";
          li.innerHTML = `<span>#${txn.queue_number}</span><span class="badge ${labelClass}">${txn.created_at}</span>`;
          listElement.appendChild(li);
        });
      }
    };

    renderQueue(priorityList, data.priority, "bg-danger", "No priority queue.");
    renderQueue(standardList, data.standard, "bg-primary", "No standard queue.");
    renderQueue(onHoldList, data.on_hold, "bg-warning text-dark", "No on-hold queue.");
  })
  .catch(err => {
    console.error("Error fetching public queues:", err);
  });
}

setInterval(fetchPublicQueues, 3000);
fetchPublicQueues();
</script>
  </body>
  </html>
  